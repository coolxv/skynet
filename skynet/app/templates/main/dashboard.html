{% extends "base.html" %}


{% block header %}

    <link href="{{ url_for('static', filename='css/plugins/morris.css') }}" rel="stylesheet" type="text/css">
{% endblock %}




{% block content %}

    <!-- Page Heading -->
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">
                仪表盘
            </h1>
            <ol class="breadcrumb">
                <li class="active">
                    <i class="fa fa-dashboard"></i> Plugin Count:{{ count.plugins_num }}
                </li>
            </ol>
        </div>
    </div>
    <!-- /.row -->

    <!-- /.row -->

    <div class="row">
        <div class="col-lg-3 col-md-6">
            <div class="panel panel-green">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-file-text fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">{{ count.whitelist_rules }}</div>
                            <div>白名单</div>
                        </div>
                    </div>
                </div>
                <a href="whitelist.html">
                    <div class="panel-footer">
                        <span class="pull-left">查看详情</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-file-text-o fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">{{ count.blacklist_rules }}</div>
                            <div>黑名单</div>
                        </div>
                    </div>
                </div>
                <a href="blacklist.html">
                    <div class="panel-footer">
                        <span class="pull-left">查看详情</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="panel panel-yellow">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-taxi fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">{{ count.patrollist_rules }}</div>
                            <div>巡检名单</div>
                        </div>
                    </div>
                </div>
                <a href="patrollist.html">
                    <div class="panel-footer">
                        <span class="pull-left">查看详情</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="panel panel-red">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-exclamation-triangle fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">{{ count.warning_rules }}</div>
                            <div>巡检预警</div>
                        </div>
                    </div>
                </div>
                <a href="patrollist.html">
                    <div class="panel-footer">
                        <span class="pull-left">查看详情</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
    </div>
    <!-- /.row -->



    <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>请求数据量（KB）</h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-moving-line-chart-req"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>响应数据量（100KB）</h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-moving-line-chart-rep"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-6">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>请求数</h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-moving-line-chart-treq"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="panel panel-danger">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-long-arrow-right"></i>拒绝请求数</h3>
                </div>
                <div class="panel-body">
                    <div class="flot-chart">
                        <div class="flot-chart-content" id="flot-moving-line-chart-drep"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.row -->
{% endblock %}

{% block footer %}
    <!-- morris charts -->
{#    <script src="{{ url_for('static', filename='js/plugins/morris/raphael.min.js') }}"></script>#}
{#    <script src="{{ url_for('static', filename='js/plugins/morris/morris.min.js') }}"></script>#}

    <!-- flot charts -->
    <script src="{{ url_for('static', filename='js/plugins/flot/jquery.flot.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/flot/jquery.flot.tooltip.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/flot/jquery.flot.resize.js') }}"></script>
    <script src="{{ url_for('static', filename='js/plugins/flot/jquery.flot.pie.js') }}"></script>

    <script>
        // Flot Chart Dynamic Chart
        $(function() {

            var container = $("#flot-moving-line-chart-req");

            // Determine how many data points to keep based on the placeholder's initial size;
            // this gives us a nice high-res plot while avoiding more than one point per pixel.

            var maximum = container.outerWidth() / 2 || 300;

            //

            var data = [];
            var request = 0;
            function getRandomData(msg) {

                if (data.length) {
                    data = data.slice(1);
                }

                while (data.length < maximum) {
                    data.push(msg);
                }

                // zip the generated y values with the x values

                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res;
            }

            //

            series = [{
                data: getRandomData(),
                lines: {
                    fill: true
                }
            }];

            //

            var plot = $.plot(container, series, {
                grid: {
                    borderWidth: 1,
                    minBorderMargin: 20,
                    labelMargin: 10,
                    backgroundColor: {
                        colors: ["#fff", "#e4f4f4"]
                    },
                    margin: {
                        top: 8,
                        bottom: 20,
                        left: 20
                    },
                    markings: function(axes) {
                        var markings = [];
                        var xaxis = axes.xaxis;
                        for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                            markings.push({
                                xaxis: {
                                    from: x,
                                    to: x + xaxis.tickSize
                                },
                                color: "rgba(232, 232, 255, 0.2)"
                            });
                        }
                        return markings;
                    }
                },
                xaxis: {
                    tickFormatter: function() {
                        return "";
                    }
                },
                yaxis: {
                    min: 0,
                    max: 1000
                },
                legend: {
                    show: true
                }
            });

            // Update the random dataset at 25FPS for a smoothly-animating chart

            setInterval(function updateRandom() {
                var req_url = "/api/v1/ext/stats/frontend/bin";
                var time = new Date().getTime();
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: req_url,
                    cache:false,
                    data:time,
                    async: true,
                    success: function(msg){
                        series[0].data = getRandomData(request?(msg-request)/1024:0);
                        plot.setData(series);
                        plot.draw();
                        request = msg;
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        return;
                    },
                });
            }, 1000);

        });

        $(function() {

            var container = $("#flot-moving-line-chart-rep");

            // Determine how many data points to keep based on the placeholder's initial size;
            // this gives us a nice high-res plot while avoiding more than one point per pixel.

            var maximum = container.outerWidth() / 2 || 300;

            //

            var data = [];
            var request = 0;
            function getRandomData(msg) {

                if (data.length) {
                    data = data.slice(1);
                }

                while (data.length < maximum) {
                    data.push(msg);
                }

                // zip the generated y values with the x values

                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res;
            }

            //

            series = [{
                data: getRandomData(),
                lines: {
                    fill: true
                }
            }];

            //

            var plot = $.plot(container, series, {
                grid: {
                    borderWidth: 1,
                    minBorderMargin: 20,
                    labelMargin: 10,
                    backgroundColor: {
                        colors: ["#fff", "#e4f4f4"]
                    },
                    margin: {
                        top: 8,
                        bottom: 20,
                        left: 20
                    },
                    markings: function(axes) {
                        var markings = [];
                        var xaxis = axes.xaxis;
                        for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                            markings.push({
                                xaxis: {
                                    from: x,
                                    to: x + xaxis.tickSize
                                },
                                color: "rgba(232, 232, 255, 0.2)"
                            });
                        }
                        return markings;
                    }
                },
                xaxis: {
                    tickFormatter: function() {
                        return "";
                    }
                },
                yaxis: {
                    min: 0,
                    max: 1000
                },
                legend: {
                    show: true
                }
            });

            // Update the random dataset at 25FPS for a smoothly-animating chart

            setInterval(function updateRandom() {
                var req_url = "/api/v1/ext/stats/frontend/bout";
                var time = new Date().getTime();
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: req_url,
                    cache:false,
                    data:time,
                    async: true,
                    success: function(msg){
                        series[0].data = getRandomData(request?(msg-request)/102400:0);
                        plot.setData(series);
                        plot.draw();
                        request = msg;
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        return;
                    },
                });
            }, 1000);

        });

        $(function() {

            var container = $("#flot-moving-line-chart-treq");

            // Determine how many data points to keep based on the placeholder's initial size;
            // this gives us a nice high-res plot while avoiding more than one point per pixel.

            var maximum = container.outerWidth() / 2 || 300;

            //

            var data = [];
            var request = 0;
            function getRandomData(msg) {

                if (data.length) {
                    data = data.slice(1);
                }

                while (data.length < maximum) {
                    data.push(msg);
                }

                // zip the generated y values with the x values

                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res;
            }

            //

            series = [{
                data: getRandomData(),
                lines: {
                    fill: true
                }
            }];

            //

            var plot = $.plot(container, series, {
                grid: {
                    borderWidth: 1,
                    minBorderMargin: 20,
                    labelMargin: 10,
                    backgroundColor: {
                        colors: ["#fff", "#e4f4f4"]
                    },
                    margin: {
                        top: 8,
                        bottom: 20,
                        left: 20
                    },
                    markings: function(axes) {
                        var markings = [];
                        var xaxis = axes.xaxis;
                        for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                            markings.push({
                                xaxis: {
                                    from: x,
                                    to: x + xaxis.tickSize
                                },
                                color: "rgba(232, 232, 255, 0.2)"
                            });
                        }
                        return markings;
                    }
                },
                xaxis: {
                    tickFormatter: function() {
                        return "";
                    }
                },
                yaxis: {
                    min: 0,
                    max: 1000
                },
                legend: {
                    show: true
                }
            });

            // Update the random dataset at 25FPS for a smoothly-animating chart

            setInterval(function updateRandom() {
                var req_url = "/api/v1/ext/stats/frontend/req_tot";
                var time = new Date().getTime();
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: req_url,
                    cache:false,
                    data:time,
                    async: true,
                    success: function(msg){
                        series[0].data = getRandomData(request?(msg-request):0);
                        plot.setData(series);
                        plot.draw();
                        request = msg;
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        return;
                    },
                });
            }, 1000);

        });

        $(function() {

            var container = $("#flot-moving-line-chart-drep");

            // Determine how many data points to keep based on the placeholder's initial size;
            // this gives us a nice high-res plot while avoiding more than one point per pixel.

            var maximum = container.outerWidth() / 2 || 300;

            //

            var data = [];
            var request = 0;
            function getRandomData(msg) {

                if (data.length) {
                    data = data.slice(1);
                }

                while (data.length < maximum) {
                    data.push(msg);
                }

                // zip the generated y values with the x values

                var res = [];
                for (var i = 0; i < data.length; ++i) {
                    res.push([i, data[i]])
                }

                return res;
            }

            //

            series = [{
                data: getRandomData(),
                lines: {
                    fill: true
                }
            }];

            //

            var plot = $.plot(container, series, {
                grid: {
                    borderWidth: 1,
                    minBorderMargin: 20,
                    labelMargin: 10,
                    backgroundColor: {
                        colors: ["#fff", "#e4f4f4"]
                    },
                    margin: {
                        top: 8,
                        bottom: 20,
                        left: 20
                    },
                    markings: function(axes) {
                        var markings = [];
                        var xaxis = axes.xaxis;
                        for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                            markings.push({
                                xaxis: {
                                    from: x,
                                    to: x + xaxis.tickSize
                                },
                                color: "rgba(232, 232, 255, 0.2)"
                            });
                        }
                        return markings;
                    }
                },
                xaxis: {
                    tickFormatter: function() {
                        return "";
                    }
                },
                yaxis: {
                    min: 0,
                    max: 1000
                },
                legend: {
                    show: true
                }
            });

            // Update the random dataset at 25FPS for a smoothly-animating chart

            setInterval(function updateRandom() {
                var req_url = "/api/v1/ext/stats/frontend/dreq";
                var time = new Date().getTime();
                $.ajax({
                    type: "GET",
                    contentType: "application/json; charset=utf-8",
                    url: req_url,
                    cache:false,
                    data:time,
                    async: true,
{#                    beforeSend: function(xhr) {#}
{#                        xhr.setRequestHeader("Authorization", "Bearer ZnJvbWFwcGx********uOnRoM24zcmQ1UmgzcjM=")#}
{#                    },#}
                    success: function(msg){
                        series[0].data = getRandomData(request?(msg-request):0);
                        plot.setData(series);
                        plot.draw();
                        request = msg;
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        return;
                    },
                });
            }, 1000);

        });
    </script>
{% endblock %}













